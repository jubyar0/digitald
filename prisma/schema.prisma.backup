generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                       String                    @id @default(cuid())
  email                    String                    @unique
  name                     String?
  password                 String?
  rememberToken            String?
  role                     Role                      @default(CUSTOMER)
  createdAt                DateTime                  @default(now())
  updatedAt                DateTime                  @updatedAt
  addresses                Address[]
  adminAccount             AdminAccount?
  announcements            Announcement[]
  bannedByEntries          BannedUser[]              @relation("BannedByUsers")
  bannedUsers              BannedUser?
  cmsPages                 CmsPage[]
  content                  Content[]
  conversations            ConversationParticipant[]
  customerConversations    Conversation[]            @relation("CustomerConversations")
  cryptoWallets            CryptoWallet[]
  uploadedFiles            DigitalFile[]             @relation("DigitalFileUploaders")
  disputeParticipants      DisputeParticipant[]
  disputesInitiated        Dispute[]                 @relation("UserDisputes")
  escrowAccounts           EscrowAccount[]
  receivedMessages         Message[]                 @relation("ReceivedMessages")
  sentMessages             Message[]                 @relation("SentMessages")
  orders                   Order[]                   @relation("UserOrders")
  generatedReports         Report[]                  @relation("ReportGenerators")
  reviews                  Review[]
  assignedTickets          SupportTicket[]           @relation("SupportTicketAssignees")
  supportTickets           SupportTicket[]
  vendorApplicationReviews VendorApplication[]       @relation("VendorApplicationReviewers")
  vendors                  Vendor?                   @relation("UserVendors")
  wallet                   Wallet?
  wishlist                 Wishlist[]
  processedWithdrawals     Withdrawal[]              @relation("WithdrawalProcessors")
  cart                     Cart?
  notifications            Notification[]
  auditLogs                AuditLog[]
  transactions             Transaction[]
  productVersions          ProductVersion[]          @relation("ProductVersionUploaders")
  affiliates               Affiliate[]               @relation("UserAffiliates")
  couponUsages             CouponUsage[]             @relation("CouponUsers")
  
  // Seller profile relations
  following                Follow[]                  @relation("UserFollowing")
  sellerReviews            SellerReview[]            @relation("UserSellerReviews")

  @@index([role])
  @@index([createdAt])
  @@index([role, createdAt])
  @@map("users")
}

model Vendor {
  id                  String               @id @default(cuid())
  name                String
  description         String?
  userId              String               @unique
  
  // Profile fields
  bio                 String?              @db.Text
  specializations     Json?                // Array of specializations
  location            String?
  avatar              String?
  coverImage          String?
  socialLinks         Json?                // Object with social media links
  themeColor          String?              @default("#000000")
  featuredLayout      String?              @default("grid") // grid, list, carousel
  
  // Stats
  totalFollowers      Int                  @default(0)
  averageRating       Float                @default(0)
  totalReviews        Int                  @default(0)
  
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  affiliates          Affiliate[]
  coupons             Coupon[]
  discounts           Discount[]
  escrowAccount       EscrowAccount?
  invoices            Invoice[]
  notificationSetting NotificationSetting?
  orders              Order[]              @relation("VendorOrders")
  products            Product[]
  promotions          Promotion[]
  shippingSetting     ShippingSetting?
  taxSetting          TaxSetting?
  vendorApplication   VendorApplication?
  user                User                 @relation("UserVendors", fields: [userId], references: [id])
  withdrawals         Withdrawal[]
  
  // New relations
  badges              VendorBadge[]
  softwareTools       VendorSoftwareTool[]
  followers           Follow[]             @relation("VendorFollowers")
  sellerReviews       SellerReview[]
  payoutMethods       VendorPayoutMethod[] @relation("VendorPayoutMethods")
  conversations       Conversation[]       @relation("VendorConversations")

  @@index([userId])
  @@index([createdAt])
  @@index([averageRating])
  @@map("vendors")
}

model VendorPayoutMethod {
  id          String      @id @default(cuid())
  vendorId    String
  type        PaymentType // PAYPAL, BANK_TRANSFER, CRYPTO, STRIPE
  label       String      // User-friendly name like "My PayPal" or "Main Bank Account"
  details     Json        // Flexible storage for different payment method details
  isDefault   Boolean     @default(false)
  isActive    Boolean     @default(true)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  vendor      Vendor      @relation("VendorPayoutMethods", fields: [vendorId], references: [id], onDelete: Cascade)

  @@index([vendorId])
  @@index([vendorId, isDefault])
  @@map("vendor_payout_methods")
}

model Category {
  id       String     @id @default(cuid())
  name     String     @unique
  slug     String     @unique
  isActive Boolean    @default(true)
  parentId String?
  parent   Category?  @relation("CategoryRelation", fields: [parentId], references: [id])
  children Category[] @relation("CategoryRelation")
  products Product[]

  @@index([isActive])
  @@index([parentId])
  @@map("categories")
}

model Product {
  id                   String           @id @default(cuid())
  name                 String
  description          String
  price                Float
  currency             String           @default("USD")
  categoryId           String
  vendorId             String
  fileUrl              String
  thumbnail            String?
  images               Json?            // Array of image URLs
  isActive             Boolean          @default(true)
  status               ProductStatus    @default(PENDING)
  isDraft              Boolean          @default(false)
  currentVersion       String?          @default("1.0.0")
  reviewNotes          String?          // Admin feedback on rejection
  createdAt            DateTime         @default(now())
  updatedAt            DateTime         @updatedAt
  assetDetails         String?
  includedResolution   String?
  availableResolutions String?
  height               Float?
  width                Float?
  depth                Float?
  meshCount            Int?
  textureFiles         Json?
  nativeFileFormats    Json?
  universalFileFormats Json?
  addonSupport         Json?
  licenseInfo          Json?
  digitalFiles         DigitalFile[]
  disputes             Dispute[]
  orders               OrderItem[]
  productTags          ProductTag[]
  category             Category         @relation(fields: [categoryId], references: [id])
  vendor               Vendor           @relation(fields: [vendorId], references: [id])
  reviews              Review[]
  wishlistedBy         Wishlist[]
  tags                 Tag[]            @relation("ProductTags")
  versions             ProductVersion[]
  cartItems            CartItem[]
  views                Int              @default(0)
  downloads            Int              @default(0)
  likes                Int              @default(0)

  @@index([status])
  @@index([categoryId])
  @@index([vendorId])
  @@index([createdAt])
  @@index([isActive])
  @@index([status, categoryId])
  @@index([status, vendorId])
  @@map("products")
}

model EscrowAccount {
  id               String              @id @default(cuid())
  userId           String?
  vendorId         String?             @unique
  balance          Float               @default(0)
  availableBalance Float               @default(0) // Balance available for withdrawal
  currency         String              @default("USD")
  holdUntil        DateTime?           // Hold period end date
  createdAt        DateTime            @default(now())
  updatedAt        DateTime            @updatedAt
  user             User?               @relation(fields: [userId], references: [id])
  vendor           Vendor?             @relation(fields: [vendorId], references: [id])
  transactions     EscrowTransaction[]

  @@unique([userId, vendorId])
  @@index([userId])
  @@index([vendorId])
  @@map("escrow_accounts")
}

model EscrowTransaction {
  id              String                  @id @default(cuid())
  escrowAccountId String
  orderId         String?                 @unique
  amount          Float
  type            EscrowTransactionType
  status          EscrowTransactionStatus
  description     String?
  createdAt       DateTime                @default(now())
  updatedAt       DateTime                @updatedAt
  escrowAccount   EscrowAccount           @relation(fields: [escrowAccountId], references: [id])
  order           Order?                  @relation(fields: [orderId], references: [id])

  @@index([escrowAccountId])
  @@index([status])
  @@index([createdAt])
  @@map("escrow_transactions")
}

model Order {
  id                String             @id @default(cuid())
  userId            String
  vendorId          String
  totalAmount       Float
  currency          String             @default("USD")
  status            OrderStatus        @default(PENDING)
  paymentId         String? // Keep for backward compatibility or direct reference
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  payment           Payment?
  cryptoPayment     CryptoPayment?
  dispute           Dispute?
  escrowTransaction EscrowTransaction?
  items             OrderItem[]
  user              User               @relation("UserOrders", fields: [userId], references: [id])
  vendor            Vendor             @relation("VendorOrders", fields: [vendorId], references: [id])
  sellerReviews     SellerReview[]     @relation("OrderSellerReviews")
  refunds           Refund[]

  @@index([userId])
  @@index([vendorId])
  @@index([status])
  @@index([createdAt])
  @@index([status, vendorId])
  @@index([status, userId])
  @@map("orders")
}

model Payment {
  id              String        @id @default(cuid())
  orderId         String        @unique
  amount          Float
  currency        String        @default("USD")
  provider        PaymentGateway
  status          PaymentStatus @default(PENDING)
  transactionId   String?       // External transaction ID (Stripe PaymentIntent, PayPal OrderID, etc.)
  metadata        Json?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  order           Order         @relation(fields: [orderId], references: [id])

  @@index([status])
  @@index([provider])
  @@map("payments")
}

model Transaction {
  id          String            @id @default(cuid())
  type        TransactionType
  amount      Float
  currency    String            @default("USD")
  status      TransactionStatus @default(COMPLETED)
  description String?
  referenceId String?           // ID of related entity (Order, Payment, Withdrawal)
  userId      String?           // User involved (Buyer or Seller)
  metadata    Json?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  user        User?             @relation(fields: [userId], references: [id])

  @@index([type])
  @@index([userId])
  @@index([createdAt])
  @@map("transactions")
}

enum PaymentGateway {
  STRIPE
  PAYPAL
  CRYPTOMUS
  BALANCE
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

enum TransactionType {
  PAYMENT_IN          // User pays platform
  PAYMENT_OUT         // Platform pays user (withdrawal)
  COMMISSION_PLATFORM // Platform takes cut
  COMMISSION_SELLER   // Seller gets cut
  REFUND              // Money returned
  ADJUSTMENT          // Manual correction
}

enum TransactionStatus {
  PENDING
  COMPLETED
  FAILED
  CANCELLED
}

model OrderItem {
  id        String  @id @default(cuid())
  orderId   String
  productId String
  quantity  Int
  price     Float
  order     Order   @relation(fields: [orderId], references: [id])
  product   Product @relation(fields: [productId], references: [id])

  @@index([orderId])
  @@index([productId])
  @@map("order_items")
}

model Conversation {
  id           String                    @id @default(cuid())
  createdAt    DateTime                  @default(now())
  updatedAt    DateTime                  @updatedAt
  participants ConversationParticipant[]
  dispute      Dispute?                  @relation("ConversationDispute")
  messages     Message[]
  
  vendorId    String?
  customerId  String?
  vendor      Vendor?    @relation("VendorConversations", fields: [vendorId], references: [id])
  customer    User?      @relation("CustomerConversations", fields: [customerId], references: [id])


  @@map("conversations")
}

model ConversationParticipant {
  id             String       @id @default(cuid())
  userId         String
  conversationId String
  createdAt      DateTime     @default(now())
  conversation   Conversation @relation(fields: [conversationId], references: [id])
  user           User         @relation(fields: [userId], references: [id])

  @@unique([userId, conversationId])
  @@map("conversation_participants")
}

model Message {
  id             String       @id @default(cuid())
  conversationId String
  senderId       String
  receiverId     String?
  content        String
  readAt         DateTime?
  read           Boolean      @default(false)
  createdAt      DateTime     @default(now())
  conversation   Conversation @relation(fields: [conversationId], references: [id])
  receiver       User         @relation("ReceivedMessages", fields: [receiverId], references: [id])
  sender         User         @relation("SentMessages", fields: [senderId], references: [id])

  @@index([conversationId])
  @@index([senderId])
  @@index([receiverId])
  @@index([conversationId, createdAt])
  @@map("messages")
}

model Dispute {
  id                     String               @id @default(cuid())
  orderId                String               @unique
  productId              String
  initiatorId            String
  status                 DisputeStatus        @default(PENDING)
  reason                 String
  disputeReason          DisputeReason?       // Structured reason
  evidenceFiles          Json?                // Array of evidence file URLs
  resolution             String?
  resolvedByAdmin        Boolean              @default(false)
  conversationId         String?              @unique
  buyerResponseDeadline  DateTime?
  sellerResponseDeadline DateTime?
  refundAmount           Float?
  refundProcessed        Boolean              @default(false)
  createdAt              DateTime             @default(now())
  updatedAt              DateTime             @updatedAt
  participants           DisputeParticipant[]
  conversation           Conversation?        @relation("ConversationDispute", fields: [conversationId], references: [id])
  initiator              User                 @relation("UserDisputes", fields: [initiatorId], references: [id])
  order                  Order                @relation(fields: [orderId], references: [id])
  product                Product              @relation(fields: [productId], references: [id])

  @@index([status])
  @@index([initiatorId])
  @@index([productId])
  @@index([createdAt])
  @@index([status, createdAt])
  @@map("disputes")
}

model DisputeParticipant {
  id        String      @id @default(cuid())
  disputeId String
  userId    String
  role      DisputeRole
  createdAt DateTime    @default(now())
  dispute   Dispute     @relation(fields: [disputeId], references: [id])
  user      User        @relation(fields: [userId], references: [id])

  @@unique([disputeId, userId])
  @@map("dispute_participants")
}

model Tag {
  id          String       @id @default(cuid())
  name        String       @unique
  slug        String       @unique
  isActive    Boolean      @default(true)
  productTags ProductTag[]
  products    Product[]    @relation("ProductTags")

  @@map("tags")
}

model ProductTag {
  productId  String
  tagId      String
  assignedAt DateTime @default(now())
  assignedBy String
  product    Product  @relation(fields: [productId], references: [id])
  tag        Tag      @relation(fields: [tagId], references: [id])

  @@id([productId, tagId])
  @@map("product_tags")
}

model PlatformSetting {
  id                   String   @id @default(cuid())
  platformFeePercent   Float    @default(30.0) // Changed to 30%
  cryptoPaymentEnabled Boolean  @default(true)
  disputePeriodDays    Int      @default(14)   // Days to open dispute
  escrowHoldDays       Int      @default(7)    // Days to hold funds in escrow
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  @@map("platform_settings")
}

model CryptoWallet {
  id        String   @id @default(cuid())
  userId    String
  address   String   @unique
  chain     String
  currency  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id])

  @@map("crypto_wallets")
}

model CryptoPayment {
  id                String              @id @default(cuid())
  orderId           String              @unique
  amount            Float
  currency          String
  chain             String
  fromAddress       String
  toAddress         String
  transactionHash   String              @unique
  status            CryptoPaymentStatus @default(PENDING)
  webhookReceivedAt DateTime?
  confirmedAt       DateTime?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  order             Order               @relation(fields: [orderId], references: [id])

  @@map("crypto_payments")
}

model DashboardStat {
  id        String   @id @default(cuid())
  key       String   @unique
  value     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("dashboard_stats")
}

model BannedUser {
  id           String    @id @default(cuid())
  userId       String    @unique
  reason       String
  bannedBy     String
  banStart     DateTime  @default(now())
  banEnd       DateTime?
  isActive     Boolean   @default(true)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  bannedByUser User      @relation("BannedByUsers", fields: [bannedBy], references: [id])
  user         User      @relation(fields: [userId], references: [id])

  @@index([isActive])
  @@index([createdAt])
  @@map("banned_users")
}

model VendorApplication {
  id         String                  @id @default(cuid())
  vendorId   String                  @unique
  status     VendorApplicationStatus @default(PENDING)
  notes      String?
  reviewedBy String?
  reviewedAt DateTime?
  createdAt  DateTime                @default(now())
  updatedAt  DateTime                @updatedAt
  reviewer   User?                   @relation("VendorApplicationReviewers", fields: [reviewedBy], references: [id])
  vendor     Vendor                  @relation(fields: [vendorId], references: [id])

  @@index([status])
  @@index([createdAt])
  @@map("vendor_applications")
}

model Withdrawal {
  id          String           @id @default(cuid())
  vendorId    String
  amount      Float
  currency    String           @default("USD")
  status      WithdrawalStatus @default(PENDING)
  method      String
  details     String
  processedBy String?
  processedAt DateTime?
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  processor   User?            @relation("WithdrawalProcessors", fields: [processedBy], references: [id])
  vendor      Vendor           @relation(fields: [vendorId], references: [id])

  @@index([vendorId])
  @@index([status])
  @@index([createdAt])
  @@index([vendorId, status])
  @@map("withdrawals")
}

model DigitalFile {
  id          String     @id @default(cuid())
  name        String
  description String?
  url         String
  size        Int
  mimeType    String
  productId   String?
  uploadedBy  String
  status      FileStatus @default(ACTIVE)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  product     Product?   @relation(fields: [productId], references: [id])
  uploader    User       @relation("DigitalFileUploaders", fields: [uploadedBy], references: [id])

  @@map("digital_files")
}

model Report {
  id          String    @id @default(cuid())
  name        String
  type        String
  data        Json
  generatedBy String
  startDate   DateTime?
  endDate     DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  generator   User      @relation("ReportGenerators", fields: [generatedBy], references: [id])

  @@map("reports")
}

model Setting {
  id          String   @id @default(cuid())
  key         String   @unique
  value       String
  type        String   @default("string")
  description String?
  group       String   @default("general")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("settings")
}

model SeoSetting {
  id          String   @id @default(cuid())
  page        String   @unique
  title       String?
  description String?
  keywords    String?
  author      String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("seo_settings")
}

model CmsPage {
  id          String     @id @default(cuid())
  title       String
  slug        String     @unique
  content     String
  status      PageStatus @default(DRAFT)
  authorId    String
  publishedAt DateTime?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  author      User       @relation(fields: [authorId], references: [id])

  @@map("cms_pages")
}

model SupportTicket {
  id          String         @id @default(cuid())
  subject     String
  description String
  userId      String
  status      TicketStatus   @default(OPEN)
  priority    TicketPriority @default(MEDIUM)
  assignedTo  String?
  category    String
  response    String?
  closedAt    DateTime?
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  assignee    User?          @relation("SupportTicketAssignees", fields: [assignedTo], references: [id])
  user        User           @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([status])
  @@index([assignedTo])
  @@index([userId, status])
  @@index([status, priority])
  @@map("support_tickets")
}

model SystemLog {
  id        String   @id @default(cuid())
  level     String
  message   String
  metadata  Json?
  timestamp DateTime @default(now())

  @@map("system_logs")
}

model Announcement {
  id        String             @id @default(cuid())
  title     String
  content   String
  status    AnnouncementStatus @default(DRAFT)
  priority  Int                @default(0)
  startDate DateTime?
  endDate   DateTime?
  createdBy String
  createdAt DateTime           @default(now())
  updatedAt DateTime           @updatedAt
  author    User               @relation(fields: [createdBy], references: [id])

  @@map("announcements")
}

model AdminAccount {
  id          String    @id @default(cuid())
  userId      String    @unique
  permissions Json?
  lastLogin   DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  user        User      @relation(fields: [userId], references: [id])

  @@map("admin_accounts")
}

model NavigationItem {
  id          String           @id @default(cuid())
  label       String
  url         String
  order       Int
  isActive    Boolean          @default(true)
  isSection   Boolean          @default(false)
  parentId    String?
  icon        String?
  description String?
  image       String?
  isFeatured  Boolean          @default(false)
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  parent      NavigationItem?  @relation("NavigationItems", fields: [parentId], references: [id])
  children    NavigationItem[] @relation("NavigationItems")

  @@map("navigation_items")
}

model Content {
  id              String        @id @default(cuid())
  title           String
  slug            String        @unique
  content         String
  excerpt         String?
  status          ContentStatus @default(DRAFT)
  contentType     String
  authorId        String
  parentId        String?
  featuredImage   String?
  metaTitle       String?
  metaDescription String?
  tags            String[]
  categories      String[]
  publishedAt     DateTime?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  author          User          @relation(fields: [authorId], references: [id])
  parent          Content?      @relation("ContentRelation", fields: [parentId], references: [id])
  children        Content[]     @relation("ContentRelation")

  @@map("content")
}

model Discount {
  id          String       @id @default(cuid())
  vendorId    String
  name        String
  description String?
  type        DiscountType
  value       Float
  minPurchase Float?
  maxDiscount Float?
  startDate   DateTime
  endDate     DateTime
  isActive    Boolean      @default(true)
  usageLimit  Int?
  usageCount  Int          @default(0)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  vendor      Vendor       @relation(fields: [vendorId], references: [id])

  @@map("discounts")
}

model Coupon {
  id          String        @id @default(cuid())
  vendorId    String
  code        String        @unique
  description String?
  type        CouponType
  value       Float
  minPurchase Float?
  maxDiscount Float?
  startDate   DateTime
  endDate     DateTime
  isActive    Boolean       @default(true)
  usageLimit  Int?
  usageCount  Int           @default(0)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  usedBy      CouponUsage[]
  vendor      Vendor        @relation(fields: [vendorId], references: [id])

  @@map("coupons")
}

model Refund {
  id          String       @id @default(cuid())
  orderId     String
  orderItemId String?
  amount      Float
  reason      String
  status      RefundStatus @default(PENDING)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  order       Order        @relation(fields: [orderId], references: [id])

  @@map("refunds")
}

enum RefundStatus {
  PENDING
  APPROVED
  REJECTED
  COMPLETED
}

model CouponUsage {
  id       String   @id @default(cuid())
  couponId String
  userId   String
  orderId  String
  usedAt   DateTime @default(now())
  coupon   Coupon   @relation(fields: [couponId], references: [id])
  user     User     @relation("CouponUsers", fields: [userId], references: [id])

  @@index([couponId])
  @@index([userId])
  @@map("coupon_usage")
}

model Promotion {
  id          String        @id @default(cuid())
  vendorId    String
  name        String
  description String?
  type        PromotionType
  conditions  Json
  rewards     Json
  startDate   DateTime
  endDate     DateTime
  isActive    Boolean       @default(true)
  priority    Int           @default(0)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  vendor      Vendor        @relation(fields: [vendorId], references: [id])

  @@map("promotions")
}

model Affiliate {
  id             String              @id @default(cuid())
  vendorId       String
  userId         String
  code           String              @unique
  commissionRate Float
  totalEarnings  Float               @default(0)
  status         AffiliateStatus     @default(PENDING)
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  referrals      AffiliateReferral[]
  vendor         Vendor              @relation(fields: [vendorId], references: [id])
  user           User                @relation("UserAffiliates", fields: [userId], references: [id])

  @@index([vendorId])
  @@index([userId])
  @@index([status])
  @@map("affiliates")
}

model AffiliateReferral {
  id          String         @id @default(cuid())
  affiliateId String
  orderId     String
  commission  Float
  status      ReferralStatus @default(PENDING)
  paidAt      DateTime?
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  affiliate   Affiliate      @relation(fields: [affiliateId], references: [id])

  @@map("affiliate_referrals")
}

model Invoice {
  id            String        @id @default(cuid())
  vendorId      String
  orderId       String        @unique
  invoiceNumber String        @unique
  amount        Float
  tax           Float         @default(0)
  total         Float
  status        InvoiceStatus @default(PENDING)
  dueDate       DateTime?
  paidAt        DateTime?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  vendor        Vendor        @relation(fields: [vendorId], references: [id])

  @@map("invoices")
}

model ShippingSetting {
  id                    String   @id @default(cuid())
  vendorId              String   @unique
  freeShippingThreshold Float?
  flatRate              Float?
  zones                 Json?
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  vendor                Vendor   @relation(fields: [vendorId], references: [id])

  @@map("shipping_settings")
}

model TaxSetting {
  id        String   @id @default(cuid())
  vendorId  String   @unique
  taxRate   Float    @default(0)
  taxNumber String?
  regions   Json?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  vendor    Vendor   @relation(fields: [vendorId], references: [id])

  @@map("tax_settings")
}

model NotificationSetting {
  id                     String   @id @default(cuid())
  vendorId               String   @unique
  emailNotifications     Boolean  @default(true)
  orderNotifications     Boolean  @default(true)
  productNotifications   Boolean  @default(true)
  marketingNotifications Boolean  @default(false)
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
  vendor                 Vendor   @relation(fields: [vendorId], references: [id])

  @@map("notification_settings")
}

model Wishlist {
  id        String   @id @default(cuid())
  userId    String
  productId String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  product   Product  @relation(fields: [productId], references: [id])
  user      User     @relation(fields: [userId], references: [id])

  @@unique([userId, productId])
  @@map("wishlists")
}

model Review {
  id        String   @id @default(cuid())
  userId    String
  productId String
  rating    Int
  comment   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  product   Product  @relation(fields: [productId], references: [id])
  user      User     @relation(fields: [userId], references: [id])

  @@unique([userId, productId])
  @@index([productId, rating])
  @@map("reviews")
}

model Wallet {
  id             String              @id @default(cuid())
  userId         String              @unique
  balance        Float               @default(0)
  pendingBalance Float               @default(0) // Funds in escrow
  currency       String              @default("USD")
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  transactions   WalletTransaction[]
  user           User                @relation(fields: [userId], references: [id])

  @@map("wallets")
}

model WalletTransaction {
  id        String                  @id @default(cuid())
  walletId  String
  amount    Float
  type      WalletTransactionType
  status    WalletTransactionStatus @default(COMPLETED)
  reference String?
  createdAt DateTime                @default(now())
  updatedAt DateTime                @updatedAt
  wallet    Wallet                  @relation(fields: [walletId], references: [id])

  @@index([walletId])
  @@index([type])
  @@index([status])
  @@map("wallet_transactions")
}

model Address {
  id        String   @id @default(cuid())
  userId    String
  name      String
  street    String
  city      String
  state     String
  zip       String
  country   String
  isDefault Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([isDefault])
  @@map("addresses")
}

model Cart {
  id        String     @id @default(cuid())
  userId    String     @unique
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  items     CartItem[]
  user      User       @relation(fields: [userId], references: [id])

  @@map("carts")
}

model CartItem {
  id        String   @id @default(cuid())
  cartId    String
  productId String
  quantity  Int      @default(1)
  createdAt DateTime @default(now())
  cart      Cart     @relation(fields: [cartId], references: [id], onDelete: Cascade)
  product   Product  @relation(fields: [productId], references: [id])

  @@unique([cartId, productId])
  @@index([cartId])
  @@index([productId])
  @@map("cart_items")
}

model ProductVersion {
  id         String   @id @default(cuid())
  productId  String
  version    String
  fileUrl    String
  changelog  String?
  uploadedBy String
  createdAt  DateTime @default(now())
  product    Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  uploader   User     @relation("ProductVersionUploaders", fields: [uploadedBy], references: [id])

  @@index([productId])
  @@index([uploadedBy])
  @@index([createdAt])
  @@map("product_versions")
}

model Notification {
  id        String           @id @default(cuid())
  userId    String
  type      NotificationType
  title     String
  message   String
  data      Json?
  isRead    Boolean          @default(false)
  createdAt DateTime         @default(now())
  user      User             @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([type])
  @@index([userId, isRead])
  @@index([userId, createdAt])
  @@map("notifications")
}

model AuditLog {
  id        String   @id @default(cuid())
  userId    String?
  action    String
  entity    String
  entityId  String?
  changes   Json?
  ipAddress String?
  userAgent String?
  createdAt DateTime @default(now())
  user      User?    @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([entity])
  @@index([createdAt])
  @@map("audit_logs")
}

model PaymentMethod {
  id        String      @id @default(cuid())
  name      String
  type      PaymentType
  isActive  Boolean     @default(true)
  config    Json?
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt

  @@map("payment_methods")
}

enum Role {
  ADMIN
  VENDOR
  CUSTOMER
}

enum EscrowTransactionType {
  DEPOSIT
  RELEASE
  REFUND
}

enum EscrowTransactionStatus {
  PENDING
  COMPLETED
  FAILED
}

enum OrderStatus {
  PENDING
  PAID
  SHIPPED
  DELIVERED
  CANCELLED
  COMPLETED
}

enum DisputeStatus {
  PENDING
  IN_REVIEW
  RESOLVED
  CANCELLED
}

enum DisputeRole {
  BUYER
  SELLER
  ADMIN
}

enum ProductStatus {
  DRAFT
  PENDING
  PUBLISHED
  SUSPENDED
  REJECTED
}

enum CryptoPaymentStatus {
  PENDING
  CONFIRMED
  FAILED
}

enum VendorApplicationStatus {
  PENDING
  APPROVED
  REJECTED
}

enum WithdrawalStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
}

enum FileStatus {
  ACTIVE
  INACTIVE
  DELETED
}

enum PageStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum TicketStatus {
  OPEN
  IN_PROGRESS
  RESOLVED
  CLOSED
}

enum TicketPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum AnnouncementStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum ContentStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum DiscountType {
  PERCENTAGE
  FIXED_AMOUNT
}

enum CouponType {
  PERCENTAGE
  FIXED_AMOUNT
  FREE_SHIPPING
}

enum PromotionType {
  BUY_X_GET_Y
  BUNDLE
  FLASH_SALE
  SEASONAL
}

enum AffiliateStatus {
  PENDING
  ACTIVE
  SUSPENDED
  TERMINATED
}

enum ReferralStatus {
  PENDING
  APPROVED
  PAID
  CANCELLED
}

enum InvoiceStatus {
  PENDING
  PAID
  OVERDUE
  CANCELLED
}

enum WalletTransactionType {
  DEPOSIT
  WITHDRAWAL
  PURCHASE
  REFUND
}

enum WalletTransactionStatus {
  PENDING
  COMPLETED
  FAILED
}

enum DisputeReason {
  FILE_CORRUPTED
  NOT_WORKING
  WRONG_DESCRIPTION
  LICENSE_ISSUE
  SELLER_UNRESPONSIVE
  OTHER
}

enum NotificationType {
  NEW_SALE
  DISPUTE_OPENED
  DISPUTE_RESPONSE
  DISPUTE_RESOLVED
  PAYOUT_REQUESTED
  PAYOUT_PROCESSED
  REVIEW_RECEIVED
  PRODUCT_APPROVED
  PRODUCT_REJECTED
  ORDER_COMPLETED
}



model Refund {
  id          String       @id @default(cuid())
  orderId     String
  orderItemId String?
  amount      Float
  reason      String
  status      RefundStatus @default(PENDING)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  order       Order        @relation(fields: [orderId], references: [id])
  orderItem   OrderItem?   @relation(fields: [orderItemId], references: [id])

  @@index([orderId])
  @@index([orderItemId])
}

enum RefundStatus {
  PENDING
  APPROVED
  REJECTED
  COMPLETED
}

enum PaymentType {
  STRIPE
  PAYPAL
  BANK_TRANSFER
  CRYPTO
  LOCAL_GATEWAY
}


model ThemeSetting {
  id          String   @id @default(cuid())
  
  // Color Scheme - Light Mode
  primaryColor          String   @default("#3b82f6")
  secondaryColor        String   @default("#f4f4f5")
  accentColor           String   @default("#f4f4f5")
  backgroundColor       String   @default("#ffffff")
  foregroundColor       String   @default("#09090b")
  cardColor             String   @default("#ffffff")
  cardForegroundColor   String   @default("#09090b")
  borderColor           String   @default("#e4e4e7")
  inputColor            String   @default("#e4e4e7")
  mutedColor            String   @default("#f4f4f5")
  mutedForegroundColor  String   @default("#71717a")
  destructiveColor      String   @default("#dc2626")
  
  // Color Scheme - Dark Mode
  darkPrimaryColor          String   @default("#2563eb")
  darkSecondaryColor        String   @default("#27272a")
  darkAccentColor           String   @default("#18181b")
  darkBackgroundColor       String   @default("#09090b")
  darkForegroundColor       String   @default("#fafafa")
  darkCardColor             String   @default("#09090b")
  darkCardForegroundColor   String   @default("#fafafa")
  darkBorderColor           String   @default("#27272a")
  darkInputColor            String   @default("#27272a")
  darkMutedColor            String   @default("#18181b")
  darkMutedForegroundColor  String   @default("#71717a")
  darkDestructiveColor      String   @default("#dc2626")
  
  // Typography
  fontFamily        String   @default("Inter")
  fontSize          String   @default("14px")
  headingFontFamily String?
  
  // Layout
  borderRadius      String   @default("0.5rem")
  sidebarWidth      String   @default("280px")
  headerHeight      String   @default("70px")
  
  // Branding - Logos & Icons
  logoUrl           String?  // Main logo URL
  logoLightUrl      String?  // Logo for light mode
  logoDarkUrl       String?  // Logo for dark mode
  faviconUrl        String?  // Favicon URL
  logoWidth         String   @default("150px")
  logoHeight        String   @default("40px")
  
  // Branding - Site Information
  siteName          String   @default("Digital Marketplace")
  siteTagline       String?
  siteDescription   String?
  copyrightText     String?
  
  // SEO & Meta
  metaTitle         String?
  metaDescription   String?
  metaKeywords      String?
  ogImage           String?  // Open Graph image for social sharing
  
  // Social Media Links
  facebookUrl       String?
  twitterUrl        String?
  instagramUrl      String?
  linkedinUrl       String?
  youtubeUrl        String?
  githubUrl         String?
  
  // Contact Information
  contactEmail      String?
  contactPhone      String?
  contactAddress    String?
  supportEmail      String?
  
  // Footer Settings
  footerText        String?
  showSocialLinks   Boolean  @default(true)
  showContactInfo   Boolean  @default(true)
  
  // Other
  defaultMode       String   @default("light") // "light" or "dark"
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@map("theme_settings")
}

// ============================================
// Seller Profile Enhancement Models
// ============================================

model SellerBadge {
  id          String        @id @default(cuid())
  name        String        @unique
  description String?
  icon        String        // Lucide icon name
  color       String        @default("#3b82f6") // Hex color
  isActive    Boolean       @default(true)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  vendors     VendorBadge[]

  @@map("seller_badges")
}

model VendorBadge {
  id         String      @id @default(cuid())
  vendorId   String
  badgeId    String
  assignedBy String      // Admin user ID
  assignedAt DateTime    @default(now())
  vendor     Vendor      @relation(fields: [vendorId], references: [id], onDelete: Cascade)
  badge      SellerBadge @relation(fields: [badgeId], references: [id], onDelete: Cascade)

  @@unique([vendorId, badgeId])
  @@index([vendorId])
  @@index([badgeId])
  @@index([assignedBy])
  @@map("vendor_badges")
}

model SoftwareTool {
  id          String               @id @default(cuid())
  name        String               @unique
  description String?
  logoUrl     String               // URL to logo image
  category    String?              // e.g., "3D Software", "Texturing", "Rendering"
  isActive    Boolean              @default(true)
  createdAt   DateTime             @default(now())
  updatedAt   DateTime             @updatedAt
  vendors     VendorSoftwareTool[]

  @@index([isActive])
  @@map("software_tools")
}

model VendorSoftwareTool {
  id             String       @id @default(cuid())
  vendorId       String
  softwareToolId String
  addedAt        DateTime     @default(now())
  vendor         Vendor       @relation(fields: [vendorId], references: [id], onDelete: Cascade)
  softwareTool   SoftwareTool @relation(fields: [softwareToolId], references: [id], onDelete: Cascade)

  @@unique([vendorId, softwareToolId])
  @@index([vendorId])
  @@index([softwareToolId])
  @@map("vendor_software_tools")
}

model Follow {
  id          String   @id @default(cuid())
  followerId  String   // User who is following
  followingId String   // Vendor being followed
  createdAt   DateTime @default(now())
  follower    User     @relation("UserFollowing", fields: [followerId], references: [id], onDelete: Cascade)
  following   Vendor   @relation("VendorFollowers", fields: [followingId], references: [id], onDelete: Cascade)

  @@unique([followerId, followingId])
  @@index([followerId])
  @@index([followingId])
  @@map("follows")
}

model SellerReview {
  id        String   @id @default(cuid())
  userId    String
  vendorId  String
  rating    Int      // 1-5 stars
  comment   String?  @db.Text
  orderId   String?  // Optional: link to purchase
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation("UserSellerReviews", fields: [userId], references: [id], onDelete: Cascade)
  vendor    Vendor   @relation(fields: [vendorId], references: [id], onDelete: Cascade)
  order     Order?   @relation("OrderSellerReviews", fields: [orderId], references: [id], onDelete: SetNull)

  @@unique([userId, vendorId]) // One review per user per vendor
  @@index([userId])
  @@index([vendorId])
  @@index([orderId])
  @@index([rating])
  @@index([createdAt])
  @@index([vendorId, rating])
  @@map("seller_reviews")
}
