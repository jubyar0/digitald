---
apiVersion: v1
kind: Namespace
metadata:
  name: marketplace

---
apiVersion: v1
kind: ConfigMap
metadata:
  name: marketplace-config
  namespace: marketplace
data:
  PORT: "4000"
  ALLOWED_ORIGINS: "http://localhost:3000,http://localhost:3001,http://localhost:3002,http://localhost:3003"

---
apiVersion: v1
kind: Secret
metadata:
  name: marketplace-secrets
  namespace: marketplace
type: Opaque
data:
  DATABASE_URL: cG9zdGdyZXNxbDovL3Bvc3RncmVzOnBvc3RncmVzQGRhdGFiYXNlOjU0MzIvbWFya2V0cGxhY2U=
  STRIPE_SECRET_KEY: eW91cl9zdHJpcGVfc2VjcmV0X2tleQ==
  PAYPAL_CLIENT_ID: eW91cl9wYXlwYWxfY2xpZW50X2lk
  PAYPAL_CLIENT_SECRET: eW91cl9wYXlwYWxfY2xpZW50X3NlY3JldA==
  PAYPAL_ENVIRONMENT: c2FuZGJveA==

---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: marketplace-database
  namespace: marketplace
spec:
  replicas: 1
  selector:
    matchLabels:
      app: marketplace-database
  template:
    metadata:
      labels:
        app: marketplace-database
    spec:
      containers:
      - name: postgres
        image: postgres:15
        ports:
        - containerPort: 5432
        env:
        - name: POSTGRES_USER
          value: "postgres"
        - name: POSTGRES_PASSWORD
          value: "postgres"
        - name: POSTGRES_DB
          value: "marketplace"
        volumeMounts:
        - name: postgres-storage
          mountPath: /var/lib/postgresql/data
      volumes:
      - name: postgres-storage
        emptyDir: {}

---
apiVersion: v1
kind: Service
metadata:
  name: marketplace-database-service
  namespace: marketplace
spec:
  selector:
    app: marketplace-database
  ports:
    - protocol: TCP
      port: 5432
      targetPort: 5432

---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: marketplace-api
  namespace: marketplace
spec:
  replicas: 1
  selector:
    matchLabels:
      app: marketplace-api
  template:
    metadata:
      labels:
        app: marketplace-api
    spec:
      containers:
      - name: api
        image: marketplace-api:latest
        ports:
        - containerPort: 4000
        envFrom:
        - configMapRef:
            name: marketplace-config
        - secretRef:
            name: marketplace-secrets
        env:
        - name: DATABASE_URL
          value: postgresql://postgres:postgres@marketplace-database-service:5432/marketplace

---
apiVersion: v1
kind: Service
metadata:
  name: marketplace-api-service
  namespace: marketplace
spec:
  selector:
    app: marketplace-api
  ports:
    - protocol: TCP
      port: 4000
      targetPort: 4000
  type: LoadBalancer

---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: marketplace-frontend
  namespace: marketplace
spec:
  replicas: 1
  selector:
    matchLabels:
      app: marketplace-frontend
  template:
    metadata:
      labels:
        app: marketplace-frontend
    spec:
      containers:
      - name: frontend
        image: marketplace-frontend:latest
        ports:
        - containerPort: 3000
        env:
        - name: NEXT_PUBLIC_BACKEND_API_URL
          value: http://marketplace-api-service:4000

---
apiVersion: v1
kind: Service
metadata:
  name: marketplace-frontend-service
  namespace: marketplace
spec:
  selector:
    app: marketplace-frontend
  ports:
    - protocol: TCP
      port: 3000
      targetPort: 3000
  type: LoadBalancer

---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: marketplace-admin-dashboard
  namespace: marketplace
spec:
  replicas: 1
  selector:
    matchLabels:
      app: marketplace-admin-dashboard
  template:
    metadata:
      labels:
        app: marketplace-admin-dashboard
    spec:
      containers:
      - name: admin-dashboard
        image: marketplace-admin-dashboard:latest
        ports:
        - containerPort: 3001
        env:
        - name: NEXT_PUBLIC_BACKEND_API_URL
          value: http://marketplace-api-service:4000

---
apiVersion: v1
kind: Service
metadata:
  name: marketplace-admin-dashboard-service
  namespace: marketplace
spec:
  selector:
    app: marketplace-admin-dashboard
  ports:
    - protocol: TCP
      port: 3001
      targetPort: 3001
  type: LoadBalancer

---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: marketplace-vendor-dashboard
  namespace: marketplace
spec:
  replicas: 1
  selector:
    matchLabels:
      app: marketplace-vendor-dashboard
  template:
    metadata:
      labels:
        app: marketplace-vendor-dashboard
    spec:
      containers:
      - name: vendor-dashboard
        image: marketplace-vendor-dashboard:latest
        ports:
        - containerPort: 3002
        env:
        - name: NEXT_PUBLIC_BACKEND_API_URL
          value: http://marketplace-api-service:4000

---
apiVersion: v1
kind: Service
metadata:
  name: marketplace-vendor-dashboard-service
  namespace: marketplace
spec:
  selector:
    app: marketplace-vendor-dashboard
  ports:
    - protocol: TCP
      port: 3002
      targetPort: 3002
  type: LoadBalancer

---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: marketplace-user-dashboard
  namespace: marketplace
spec:
  replicas: 1
  selector:
    matchLabels:
      app: marketplace-user-dashboard
  template:
    metadata:
      labels:
        app: marketplace-user-dashboard
    spec:
      containers:
      - name: user-dashboard
        image: marketplace-user-dashboard:latest
        ports:
        - containerPort: 3003
        env:
        - name: NEXT_PUBLIC_BACKEND_API_URL
          value: http://marketplace-api-service:4000

---
apiVersion: v1
kind: Service
metadata:
  name: marketplace-user-dashboard-service
  namespace: marketplace
spec:
  selector:
    app: marketplace-user-dashboard
  ports:
    - protocol: TCP
      port: 3003
      targetPort: 3003
  type: LoadBalancer